# 05. Au niveau d'un `assembly`

<img src="assets/Screenshot2020-10-22at14.53.10.png" alt="Screenshot 2020-10-22 at 14.53.10" style="zoom:50%;" />

### `Assembly: keyword`

On utilise un d√©-compilateur en `.net core` car le fichier de m√©tadonn√©e n'est plus accessible.

<img src="assets/Screenshot2020-10-22at15.00.06.png" alt="Screenshot 2020-10-22 at 15.00.06" style="zoom:50%;" />

Automatiquement le contenu de `project.csproj` est transform√© en `assembly info` par le compilateur.

On peut cr√©er ce fichier si on le d√©sire :

`AssemblyInfo.cs`

```csharp
using System.Reflection;

[assembly: AssemblyCopyright("zzzzzzzzzzz")]
```

On retrouve ce fichier lorsque l'on `build` une `class library` :

`LibLinked/obj/Debug/netstandard2.0/LibLinked.AssemblyInfo.cs`

```csharp
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("LibLinked")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("LibLinked")]
[assembly: System.Reflection.AssemblyTitleAttribute("LibLinked")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Generated by the MSBuild WriteCodeFragment class.


```

## `InternalVisibleTo` : donner un acc√®s√† la visibilit√© `internal`

`internal` seulement visible par le m√™me `assembly`.

Cet `attribut` est utile pour des test et rends accessible des √©l√©ments not√©s `internal` √† un autre `assembly`.

### Cr√©ation d'un projet de test

```bash
ü¶Ñ csharp-attribute dotnet new xunit -n ContactWriter.Test
```

On cr√©e dans notre projet principal une classe `internal` (seulement visible par son propre `assembly`).

erreur :

```bash
error CS0246: The type or namespace name 'Xunit' could not be found (are you missing a using directive or an assembly reference?)
```

> Solution : Il ne faut pas imbriquer les projets.
>
> √Ä la place les deux projets doivent √™tre s√©par√©s (c√¥te √† c√¥te par exemple).

### Ajoute d'une r√©f√©rence vers le projet principal

```bash
ü¶Ñ ContactWriter.Test dotnet add reference /Users/kar/Documents/programmation/dotnet/csharp-attribute/ContactWriter/csharp-attributes.csproj
```

Ce qui donne dans ` ContactWriter.Test.csproj`

```csharp
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>netcoreapp3.1</TargetFramework>

    <IsPackable>false</IsPackable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="16.5.0" />
    <PackageReference Include="xunit" Version="2.4.0" />
    <PackageReference Include="xunit.runner.visualstudio" Version="2.4.0" />
    <PackageReference Include="coverlet.collector" Version="1.2.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\ContactWriter\csharp-attributes.csproj" />
  </ItemGroup>

</Project>
```

### Dans la classe de test `UnitTest1.cs`

```csharp
using System;
using Xunit;
using csharp_attributes;

namespace ContactWriter.Test
{
    public class UnitTest1
    {
        [Fact]
        public void Test1()
        {
            var x = new SomeinternalClass();
        }
    }
}
```

<img src="assets/Screenshot2020-10-22at16.57.36.png" alt="Screenshot 2020-10-22 at 16.57.36" style="zoom:50%;" />

### Rendre la classe `internal` accessible

Dans `ContactWriter/AssemblyInfo.cs`

```csharp
using System.Reflection;
using System.Runtime.CompilerServices;

[assembly: AssemblyCopyright("zzzzzzzzzzz")]
[assembly: InternalsVisibleTo("ContactWriter.Test")]
```

<img src="assets/Screenshot2020-10-23at10.05.38.png" alt="Screenshot 2020-10-23 at 10.05.38" style="zoom:50%;" />

La classe `SomeinternalClass` est maintenant accessible et on peut lancer le test.
